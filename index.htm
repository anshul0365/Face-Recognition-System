<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Recognition System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous"></script>
    <style>
        .div-video{
            text-align: center;
        }
        .downloadImage{
            display: none;
        }
        .liveStreamCanvas{
            transform: scaleX(-1);
        }
        video {
            transform: scaleX(-1);
            width: 840px;
            /* height: 100%; */
        }
    </style>
</head>
<body>
    <div class="div-video">
        <video autoplay="true" id="liveStream"></video>
        <button id="capture" type="button">Capture</button>
    </div>
    <div>
        <canvas id="liveStreamCanvas" class="liveStreamCanvas"></canvas>
        <!-- <img id="liveStreamImg"> -->
    </div>

    <script type="text/javascript">
        var video = document.querySelector("#liveStream");
        var canvas  = document.querySelector('#liveStreamCanvas');
        // var img = document.getElementById('liveStreamImg');
        var timeCount = 1;
        function startVideoStream(){
            if (navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function (stream) {
                        video.srcObject = stream;
                    })
                    .catch(function (error) {
                        console.log("Something went wrong!");
                    });
            }
        }
        function captureImage(){
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0, video.videoWidth, video.videoHeight);
            var data = canvas.toDataURL('image/png');
            canvas.setAttribute('src', data);
            // img.src = canvas.toDataURL();
            $.ajax({
                type: "POST",
                url: "http://127.0.0.1:5000/saveImage",
                headers: {
                    'Access-Control-Allow-Origin': '*'
                },
                data: {
                    imageData: data,
                    count: timeCount
                }
            }).done(function (data) {
                console.log(data);
                // console.log(typeof(data));
                // getBase64Image(data, 'image/png');
            });
            // downloadLink.href = data;
            // downloadLink.download = "mypainting.png";
            // console.log(dwnldLink);

            // canvas.toBlob()(blob => {
            //     const img = new Image();
            //     img.src = window.URL.createObjectUrl(blob);
            // });
        }

        function getName(){
            var Name = "ABC";
            $.ajax({
                type: "POST",
                url: "http://127.0.0.1:5000/getName",
                headers: {
                    // 'Access-Control-Allow-Origin': '*'
                },
                data: {
                    name: Name,
                    // count: timeCount
                }
            }).done(function (data) {
                console.log(data);
            });
        }

        // function getBase64Image(src, outputFormat) {
        //         const img = new Image();
        //         img.crossOrigin = 'Anonymous';
        //         img.onload = () => {
        //             const canvas = document.createElement('canvas');
        //             const ctx = canvas.getContext('2d');
        //             let dataURL;
        //             canvas.height = img.naturalHeight;
        //             canvas.width = img.naturalWidth;
        //             ctx.drawImage(img, 0, 0);
        //             dataURL = canvas.toDataURL(outputFormat);
        //             // callback(dataURL);
        //         };

        //         img.src = src;
        //         if (img.complete || img.complete === undefined) {
        //             img.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
        //             img.src = src;
        //         }
        //     }

        // $(document).ready(function () {
        //     startVideoStream();
        //     // captureImage();
        //     var timer = setInterval(function() {
        //         captureImage();
                
        //         if(timeCount>10){
        //             clearInterval(timer);
        //             // return
        //         }
        //         console.log(timeCount);
        //         timeCount++;
        //     }, 1000); //time in millisecond
        // });

        $('#capture').click(function(){
            // captureImage();
            getName();
        });
        
    </script>
</body>
</html>